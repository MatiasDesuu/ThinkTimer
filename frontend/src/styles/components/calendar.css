/* Modern Calendar Components */

/* Calendar Header Controls */
.calendar-header-left {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

/* Ensure mini calendar popup is a top-layer overlay (override any responsive placement) */
.mini-calendar-popup {
    /* Keep fixed positioning, but avoid forcing top/right/width here so
       inline JS positioning can override for mobile. Desktop placement is
       applied in a separate media query below. */
    position: fixed !important;
    background-color: var(--bg-primary) !important;
    border: 1px solid var(--border-color) !important;
    border-radius: 8px !important;
    box-shadow: 0 10px 30px rgba(0,0,0,0.18) !important;
    z-index: 9999 !important;
    padding: 0.5rem !important;
}

#mini-calendar-container .calendar-container {
    box-shadow: none;
    padding: 0.25rem;
}

@media (max-width: 480px) {
    .mini-calendar-popup {
        /* On very small devices make popup stretch across available content area
           but stay to the right of the left nav (respecting --nav-width). */
        left: calc(var(--nav-width, 0px) + 12px) !important;
        right: 12px !important;
    top: calc(var(--header-height, 56px) - 8px) !important;
        width: auto !important;
    }
}

/* Desktop placement: explicit top/right/width for larger viewports. Keeping
   these inside a min-width media query prevents the rules from interfering
   with mobile inline positioning applied by JS. */
@media (min-width: 769px) {
    .mini-calendar-popup {
    top: var(--header-height, 64px) !important; /* position below header */
        right: 20px !important;
        width: 320px !important;
        max-width: calc(100% - 40px) !important;
    }
}
/* Larger mobile/tablet breakpoint: when the viewport is narrow we want the mini calendar
   to appear below the quickcalendar button and occupy the available width while not
   overlapping the left navigation. We use fixed positioning but align left to the
   end of the nav using the --nav-width variable so it respects collapsed/expanded nav. */
@media (max-width: 768px) {
    /* In narrow viewports place the popup inside the wrapper that sits next to the
       header buttons. This avoids fixed positioning issues and matches desktop toggle
       behavior while allowing the popup to span the available width. */
    .mini-calendar-wrapper {
        display: inline-block;
        position: relative;
        /* remove default extra margin so header spacing is controlled from main layout */
        margin-left: 0;
    }

    /* Use fixed positioning that spans the viewport minus the nav width so the
       popup occupies the full content width while respecting the left sidebar. */
    .mini-calendar-wrapper .mini-calendar-popup {
        position: fixed !important;
        top: calc(var(--header-height, 64px) + 8px) !important;
        left: calc(var(--nav-width, 0px) + 12px) !important;
        right: 12px !important;
        width: auto !important;
        max-width: calc(100vw - var(--nav-width, 0px) - 24px) !important;
        border-radius: 10px !important;
        box-shadow: 0 8px 24px rgba(0,0,0,0.12) !important;
        transform-origin: top center !important;
    }

    /* Ensure the popup stacks after header and doesn't cover primary content area
       scrolling behavior remains internal */
    .mini-calendar-popup.show {
        max-height: calc(100vh - 80px);
        overflow-y: auto;
    }
}

/* Make mini popup visually match tooltip: smaller height, entry animation and arrow */
.mini-calendar-popup {
    max-height: 360px;
    overflow: hidden;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-6px) scale(0.98);
    transition: opacity 0.18s ease, transform 0.18s ease, visibility 0.18s ease;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
}

.mini-calendar-popup.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
}

/* Arrow (piquito) pointing to the origin (top-right corner near button) */
.mini-calendar-popup::before {
    /* arrow removed for mini popup - override presentational pseudo elements */
    display: none;
}

.mini-calendar-popup::after {
    display: none;
}

/* Compact responsive adjustments for mini calendar content */
/* container inside popup: take remaining space and allow internal scrolling */
#mini-calendar-container {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0; /* allow to shrink within popup */
    overflow: hidden;
}

#mini-calendar-container .calendar-container {
    padding: 0.25rem !important;
    margin-bottom: 0 !important;
    width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
}
/* Make the calendar container a column flexbox so header stays fixed and grid can scroll */
#mini-calendar-container .calendar-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    box-sizing: border-box;
}

.mini-calendar-popup .calendar-grid {
    gap: 4px;
    /* grid should be able to scroll inside its container */
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    /* let rows size naturally but allow overflow */
    grid-auto-rows: minmax(28px, auto);
    flex: 1 1 auto;
    min-height: 0; /* allow it to shrink inside flex container */
    overflow-y: auto;
}

.mini-calendar-popup .calendar-day {
    padding: 0.25rem 0.2rem;
    min-height: 0; /* allow height to be controlled by grid rows */
    border-radius: 6px;
    box-sizing: border-box;
}

.mini-calendar-popup .calendar-day-number {
    font-weight: 600;
    margin-bottom: 0.08rem;
    font-size: 0.75rem;
}

.mini-calendar-popup .calendar-day-projects {
    gap: 0.2rem;
}

.mini-calendar-popup .calendar-project-dot {
    width: 6px;
    height: 6px;
}

.mini-calendar-popup .calendar-project-indicator {
    min-width: 14px;
    height: 14px;
    font-size: 0.62rem;
    border-radius: 4px;
}

/* Ensure tooltips inside the mini calendar don't overflow and wrap */
.mini-calendar-popup [data-tooltip] {
    white-space: normal;
}

.month-selector-group {
    position: relative;
    display: inline-block;
}

.month-selector-group::after {
    content: '\f078';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    position: absolute;
    right: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    pointer-events: none;
    transition: all 0.3s ease;
}

.month-selector-group:hover::after {
    color: var(--accent-color);
    transform: translateY(-50%) rotate(180deg);
}

.month-selector {
    padding: 0.6rem 2.5rem 0.6rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius);
    background-color: var(--bg-primary);
    color: var(--text-primary);
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    min-width: 140px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.month-selector:focus {
    outline: none;
    border-color: var(--accent-color);
    box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1), 0 2px 8px rgba(0, 0, 0, 0.1);
    transform: translateY(-1px);
}

.month-selector:hover {
    border-color: var(--accent-color);
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.month-selector option {
    padding: 0.75rem;
    background-color: var(--bg-primary);
    color: var(--text-primary);
    border: none;
}

/* Modern Calendar Container - Compact */
.calendar-container {
    background-color: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    margin-bottom: 1.5rem;
    transition: all 0.2s ease;
}

.calendar-container:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Calendar Header */
.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border-color);
}

.calendar-nav {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.calendar-nav-btn {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background-color: var(--bg-secondary);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.9rem;
}

.calendar-nav-btn:hover {
    background-color: var(--accent-color);
    color: white;
    border-color: var(--accent-color);
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(49, 130, 206, 0.2);
}

.calendar-nav-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 6px rgba(49, 130, 206, 0.2);
}

.calendar-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--text-primary);
    background: linear-gradient(135deg, var(--accent-color), #667eea);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.calendar-title i {
    background: linear-gradient(135deg, var(--accent-color), #667eea);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-size: 1.2rem;
    /* Fallback for browsers that don't support background-clip */
    color: var(--accent-color);
}

.calendar-month-btn {
    background-color: transparent; /* no background normally */
    color: inherit; /* use parent text color (will override webkit fill below) */
    border: 1px solid transparent; /* keep space for hover border to avoid layout jump */
    padding: 0rem 0.4rem; /* restore original vertical/horizontal padding */
    margin-left: -0.2rem; /* pull button left to reduce gap with icon without changing padding */
    border-radius: 8px;
    cursor: pointer;
    font: inherit;
    display: inline-flex;
    align-items: center;
    transition: all 0.15s ease;
    text-decoration: none;
    -webkit-text-fill-color: currentColor; /* ensure text is visible despite parent's transparent fill */
}

.calendar-month-btn:hover {
    background-color: var(--accent-color);
    color: #fff;
    border-color: var(--accent-color);
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(49, 130, 206, 0.2);
}

.calendar-month-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 6px rgba(49, 130, 206, 0.2);
}

.calendar-month-btn:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.12);
}

/* Modern Calendar Grid - Compact */
.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1px;
    background-color: transparent;
    border-radius: 8px;
    overflow: hidden;
}

.calendar-day-header {
    padding: 0.5rem 0.25rem;
    background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
    text-align: center;
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-radius: 4px;
    margin-bottom: 2px;
}

.calendar-day {
    padding: 0.5rem 0.375rem;
    background-color: var(--bg-primary);
    min-height: 55px;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    border-radius: 6px;
    border: 1px solid transparent;
    margin: 1px;
}

.calendar-day:hover {
    background-color: var(--bg-secondary);
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    border-color: var(--border-color);
}

.calendar-day.other-month {
    color: var(--text-muted);
    background-color: var(--bg-tertiary);
    opacity: 0.7;
}

.calendar-day.other-month:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}

.calendar-day.selected {
    background-color: var(--accent-color);
    color: white;
    border-color: var(--accent-color);
    box-shadow: 0 2px 8px rgba(49, 130, 206, 0.3);
}

.calendar-day.selected .calendar-day-number {
    color: white;
    font-weight: 700;
}

.calendar-day.today {
    border: 2px solid var(--accent-color);
    background-color: var(--bg-primary);
}

.calendar-day.today .calendar-day-number {
    color: var(--accent-color);
    font-weight: 700;
}

.calendar-day.today.selected {
    background-color: var(--accent-color);
    border-color: var(--accent-color);
}

.calendar-day.today.selected .calendar-day-number {
    color: white;
    font-weight: 700;
}

.calendar-day-number {
    font-weight: 600;
    margin-bottom: 0.125rem;
    font-size: 0.85rem;
    transition: none;
}

/* Modern Project Indicators - Simple */
.calendar-day-projects {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    gap: 0.25rem;
    width: 100%;
    margin-top: auto;
    flex-wrap: wrap;
}

/* Invisible overlay that covers the calendar day to act as a single tooltip target */
.calendar-day-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    /* Make overlay passive so it doesn't block clicks to children; we will use the day element's
       mouseenter/mouseleave to trigger the tooltip, reading the tooltip text from this overlay. */
    pointer-events: none;
    background: transparent;
    z-index: 2; /* above children but below any floating UI */
}

.calendar-project-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background-color: var(--error-color);
    transition: all 0.2s ease;
}

.calendar-day:hover .calendar-project-dot {
    transform: scale(1.2);
}

.calendar-project-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 16px;
    height: 16px;
    background-color: var(--success-color, #10b981);
    color: white;
    border-radius: 6px;
    font-size: 0.65rem;
    font-weight: 700;
    margin-top: auto;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;
}

.calendar-day:hover .calendar-project-indicator {
    transform: scale(1.1);
}

.calendar-project-indicator.multiple {
    background-color: #667eea;
}

/* Override color for selected days to ensure visibility */
.calendar-day.selected .calendar-project-indicator {
    background-color: rgba(255, 255, 255, 0.9);
    color: var(--accent-color);
    font-weight: 700;
}

.calendar-day.selected .calendar-project-dot {
    background-color: rgba(255, 255, 255, 0.9);
}

/* Calendar Add Block Button - Simple */
#add-calendar-manual-block, #add-manual-block {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    background-color: var(--accent-color);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    box-shadow: 0 2px 6px rgba(49, 130, 206, 0.2);
}

#add-calendar-manual-block:hover, #add-manual-block:hover {
    background-color: #2c5aa0;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(49, 130, 206, 0.3);
}

#add-calendar-manual-block:active, #add-manual-block:active {
    transform: translateY(0);
    box-shadow: 0 2px 6px rgba(49, 130, 206, 0.2);
}

#add-calendar-manual-block i, #add-manual-block i {
    font-size: 0.9rem;
}

/* Responsive Design for Calendar - More Compact */
@media (max-width: 768px) {
    .calendar-container {
        padding: 0.5rem;
        border-radius: 6px;
    }
    
    .calendar-day {
        min-height: 45px;
        padding: 0.375rem 0.25rem;
        border-radius: 4px;
    }
    
    .calendar-nav-btn {
        width: 28px;

/* Mini calendar popup (responsive override inside small-layout block)
   Use fixed positioning and respect the left navigation width so it doesn't
   overlap the sidebar. It will span the available content area on small
   viewports. */
.mini-calendar-popup {
    position: fixed !important;
    top: 64px !important;
    left: calc(var(--nav-width, 0px) + 12px) !important;
    right: 12px !important;
    width: auto !important;
    max-width: calc(100% - var(--nav-width, 0px) - 24px) !important;
    background-color: var(--bg-primary) !important;
    border: 1px solid var(--border-color) !important;
    border-radius: 8px !important;
    box-shadow: 0 6px 24px rgba(0,0,0,0.15) !important;
    z-index: 1200 !important;
    padding: 0.75rem !important;
}

#mini-calendar-container .calendar-container {
    box-shadow: none;
    padding: 0.5rem;
}

#open-mini-calendar {
    background: transparent;
    border: none;
    color: var(--text-primary);
    cursor: pointer;
    padding: 0.35rem;
}

#open-mini-calendar i { font-size: 1rem; }

/* Ensure the mini calendar button and custom URL button share a compact, flexible sizing
   Use min-width so they can grow or be adjusted by responsive rules in main.css */
#open-mini-calendar, #open-custom-url {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 36px;
    height: 36px;
    border-radius: 8px;
    background-color: transparent;
    border: 1px solid transparent;
    transition: all 0.15s ease;
    padding: 0.35rem;
}

#open-mini-calendar:hover, #open-custom-url:hover {
    background-color: var(--bg-secondary);
    border-color: var(--border-color);
}
        height: 28px;
        border-radius: 4px;
        font-size: 0.8rem;
    }
    
    .calendar-title {
        font-size: 0.95rem;
        gap: 0.5rem;
    }

    /* Ensure the title text doesn't get split across lines in responsive mode
       Wrap the literal title text into a single element and force it to be
       block-level on small screens so the date moves to the next line. */
    .calendar-title-text {
        display: inline-block;
        white-space: nowrap;
    }
    
    .calendar-title i {
        font-size: 0.9rem;
    }
    
    .calendar-day-header {
        padding: 0.375rem 0.25rem;
        border-radius: 3px;
        font-size: 0.65rem;
    }
    
    .calendar-project-indicator {
        min-width: 14px;
        height: 14px;
        font-size: 0.55rem;
        border-radius: 4px;
    }
    
    .calendar-day-number {
        font-size: 0.8rem;
    }
    
    /* Make the section header for time-blocks stack and ensure the Add Block
       button moves below the title and occupies the full width on small screens. */
    #calendar-page .time-blocks-section .section-header,
    #home-page .time-blocks-section .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }

    /* On small screens, force the title text to be its own line so the date
       appears below it (restores original responsive layout behavior). */
    @media (max-width: 768px) {
        #calendar-page .calendar-title .calendar-title-text {
            display: block;
        }
        #calendar-page .calendar-title #selected-calendar-date {
            display: block;
        }
    }

    /* Target both calendar and home add-block buttons so they behave the same
       in responsive layouts. Keep padding/height from the base .btn styles. */
    #add-calendar-manual-block,
    #add-manual-block {
        display: block !important;
        width: 100% !important;
        box-sizing: border-box !important;
        margin: 0; /* reset any inline or upstream margins */
    }

    /* For very small screens keep the same behaviour but slightly reduce gaps */
    @media (max-width: 480px) {
        #calendar-page .time-blocks-section .section-header,
        #home-page .time-blocks-section .section-header {
            gap: 0.35rem;
        }
    }
}
